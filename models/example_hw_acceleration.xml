<xml>
<repository>

	<!-- binaries //-->
	<binary name="gpio_drv" />
	<binary name="i2c_drv" />
	<binary name="vdma_drv" />
	<binary name="pl_irq_drv" />
	<binary name="nic_drv" />
	<binary name="nic_bridge" />
	<binary name="remote_rom_client" />
	<binary name="remote_rom_server" />
	<binary name="bitstream_loader" />
	<binary name="hw_accelerator" />
	<binary name="camera" />
	<binary name="debay" />
	<binary name="rect" />
	<binary name="object_recog" />

	<!-- components //-->
	<component name="gpio_drv" singleton="true">
		<function name="GPIO" />
		<provides>
			<service name="GPIO" max_clients="1" />
		</provides>
		<requires>
			<ram quantum="1" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="i2c_drv" singleton="true">
		<function name="I2C" />
		<provides>
			<service name="I2C" max_clients="32" />
		</provides>
		<requires>
			<ram quantum="1" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="vdma_drv" singleton="true">
		<function name="VDMA" />
		<provides>
			<service name="VDMA" max_clients="1" />
		</provides>
		<requires>
			<ram quantum="1" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="pl_irq_drv" singleton="true">
		<function name="PL_IRQ" />
		<provides>
			<service name="PL_IRQ" max_clients="1" />
		</provides>
		<requires>
			<ram quantum="1" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="nic_drv" singleton="true">
		<function name="Network" />
		<provides>
			<service name="Nic" max_clients="1" />
		</provides>
		<requires>
			<ram quantum="16" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="nic_bridge">
		<mux service="Nic" />
		<provides>
			<service name="Nic" />
		</provides>
		<requires>
			<service name="Nic" />
			<ram quantum="32" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="remote_rom_client">
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="Nic" />
			<ram quantum="32" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="remote_rom_server">
		<requires>
			<service name="Nic" />
			<service name="ROM" />
			<ram quantum="32" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="bitstream_loader">
		<function name="Dpr" />
		<provides>
			<service name="Dpr" />
		</provides>
		<requires>
			<ram quantum="1" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="hw_accelerator">
		<function name="ACCEL" />
		<provides>
			<service name="ROM" />
			<service name="ACCEL" />
		</provides>
		<requires>
			<service name="Dpr" ref="in"/>
			<service name="VDMA" ref="in"/>
			<service name="PL_IRQ" ref="in"/>
			<service name="ROM" ref="in"/>
			<ram quantum="32" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="camera" singleton="true">
		<function name="CAMERA" />
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<spec name="zynq" />
			<service name="I2C" />
			<service name="GPIO" />
			<service name="VDMA" />
			<service name="PL_IRQ" />
			<ram quantum="16" />
			<caps quantum="300" />
		</requires>
	</component>

	<component name="debay">
		<filter>
			<add tag="debay" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="left" ref="in"/>
			<ram quantum="8" />
			<caps quantum="300" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<component name="debay_right">
		<filter>
			<add tag="debay" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="right" ref="in"/>
			<ram quantum="8" />
			<caps quantum="300" />
		</requires>
		<defaults>
			<config rom="right" />
		</defaults>
		<!--timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing-->
	</component>

	<component name="debay_hw">
		<filter>
			<add tag="debay" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" ref="in"/>
			<ram quantum="8" />
			<caps quantum="300" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="60" bcet="50"/>
			</on-signal>
		</timing>
	</component>

	<component name="rect">
		<filter>
			<add tag="rect" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="debay" ref="in" />
			<ram quantum="16" />
			<caps quantum="400" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<component name="rect_right">
		<filter>
			<add tag="rect" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="right debay" ref="in" />
			<ram quantum="16" />
			<caps quantum="400" />
		</requires>
		<defaults>
			<config rom="right" />
		</defaults>
		<!--timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing-->
	</component>

	<component name="rect_hw">
		<filter>
			<add tag="rect" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="debay" ref="in" />
			<ram quantum="16" />
			<caps quantum="400" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="60" bcet="50"/>
			</on-signal>
		</timing>
	</component>

	<component name="stereo_match">
		<filter>
			<reset tag="disp" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="left" ref="left" />
			<service name="ROM" filter="right" ref="right" />
			<ram quantum="64" />
			<caps quantum="500" />
		</requires>
		<timing>
			<on-signal from_ref="left">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<component name="stereo_match_hw">
		<filter>
			<reset tag="disp" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="left" ref="left" />
			<service name="ROM" filter="right" ref="right" />
			<ram quantum="64" />
			<caps quantum="500" />
		</requires>
		<timing>
			<on-signal from_ref="left">
				<task wcet="60" bcet="50"/>
			</on-signal>
		</timing>
	</component>

	<component name="disp_to_pc">
		<filter>
			<reset tag="pointcloud" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="disp" ref="disp" />
			<service name="ROM" filter="left rect" ref="img" />
			<ram quantum="256" />
			<caps quantum="500" />
		</requires>
		<timing>
			<on-signal from_ref="disp">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<component name="disp_to_pc_hw">
		<filter>
			<reset tag="pointcloud" />
		</filter>
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" filter="disp" ref="disp" />
			<service name="ROM" filter="left rect" ref="img" />
			<ram quantum="256" />
			<caps quantum="500" />
		</requires>
		<timing>
			<on-signal from_ref="disp">
				<task wcet="60" bcet="40"/>
			</on-signal>
		</timing>
	</component>

	<component name="pose_estimation">
		<requires>
			<service name="ROM" filter="pointcloud" ref="in" />
			<ram quantum="256" />
			<caps quantum="500" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<component name="object_recog">
		<requires>
			<service name="ROM" filter="rect" ref="in" />
			<ram quantum="32" />
			<caps quantum="300" />
		</requires>
		<timing>
			<on-signal from_ref="in">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>
	</component>

	<!-- composites //-->
	<composite>
		<function name="CAMERA_COMP" />
		<provides>
			<service name="ROM" ref="out" />
		</provides>
		<requires>
			<service name="I2C" function="I2C" ref="cam_i2c" />
			<service name="GPIO" function="GPIO" ref="cam_gpio" />
			<service name="VDMA" function="VDMA" ref="cam_vdma" />
			<service name="PL_IRQ" function="PL_IRQ" ref="cam_irq" />
		</requires>

		<pattern>
			<component name="camera">
				<route>
					<service name="I2C"><external ref="cam_i2c"/></service>
					<service name="GPIO"><external ref="cam_gpio"/></service>
					<service name="VDMA"><external ref="cam_vdma"/></service>
					<service name="PL_IRQ"><external ref="cam_irq"/></service>
				</route>
				<expose ref="out">
					<service name="ROM"/>
				</expose>
			</component>
		</pattern>
	</composite>

	<composite>
		<function name="PREPROC" />
		<provides>
			<service name="ROM" ref="out" />
		</provides>
		<requires>
			<service name="ROM" function="CAMERA" ref="cam" />
		</requires>
		<timing>
			<on-signal from_ref="cam">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>

		<pattern>
			<component name="debay">
				<route><service name="ROM"><external ref="cam"/></service></route>
			</component>
			<component name="rect">
				<route><service name="ROM"><child name="debay" /></service></route>
				<expose ref="out">
					<service name="ROM"/>
				</expose>
			</component>
		</pattern>
	</composite>

	<composite name="POSE_ESTIMATION_HW">
		<function name="POSE_ESTIMATION_HW" />
		<provides>
			<service name="ROM" ref="out" />
		</provides>
		<requires>
			<service name="ROM" function="CAMERA_COMP" ref="cam" />
			<service name="Dpr" function="Dpr" ref="preproc_dpr" />
			<service name="VDMA" function="VDMA" ref="preproc_vdma" />
			<service name="PL_IRQ" function="PL_IRQ" ref="preproc_irq" />
		</requires>
		<timing>
			<on-signal from_ref="preproc">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>

		<pattern>
			<component name="hw_accelerator">
				<route>
					<service name="ROM"><external ref="cam"/></service>
					<service name="Dpr"><external ref="preproc_dpr"/></service>
					<service name="VDMA"><external ref="preproc_vdma"/></service>
					<service name="PL_IRQ"><external ref="preproc_irq"/></service>
				</route>
				<config>
					<action action="list" />
				</config>
				<expose ref="out">
					<service name="ROM"/>
				</expose>
			</component>
		</pattern>
	</composite>

	<composite name="POSE_ESTIMATION_SW">
		<function name="POSE_ESTIMATION_SW" />
		<provides>
			<service name="ROM" ref="out" />
		</provides>
		<requires>
			<service name="ROM" function="CAMERA_COMP" ref="cam_left" />
			<service name="ROM" function="CAMERA_COMP" ref="cam_right" />
		</requires>
		<timing>
			<on-signal from_ref="preproc">
				<task wcet="100" bcet="80"/>
			</on-signal>
		</timing>

		<pattern>
			<component name="debay">
				<route>
					<service name="ROM"><external ref="cam_left"/></service>
				</route>
			</component>
			<component name="debay_right">
				<route>
					<service name="ROM"><external ref="cam_right"/></service>
				</route>
			</component>
			<component name="rect">
				<route><service name="ROM"><child name="debay" /></service></route>
			</component>
			<component name="rect_right">
				<route><service name="ROM"><child name="debay_right" /></service></route>
			</component>
			<component name="stereo_match">
				<route>
					<service name="ROM" ref="left"><child name="rect" /></service>
					<service name="ROM" ref="right"><child name="rect_right" /></service>
				</route>
			</component>
			<component name="disp_to_pc">
				<route>
					<service name="ROM" ref="img"><child name="rect" /></service>
					<service name="ROM" ref="disp"><child name="stereo_match"/></service>
				</route>
				<expose ref="out">
					<service name="ROM" />
				</expose>
				<config>
					<left />
				</config>
			</component>
		</pattern>
	</composite>

	<composite name="ROM_PROXY">
		<proxy carrier="Nic" />
		<provides>
			<service name="ROM" />
		</provides>
		<requires>
			<service name="ROM" />
			<service name="Nic" function="Network" ref="from"/>
			<service name="Nic" function="Network" ref="to"/>
		</requires>

		<pattern>
			<component name="remote_rom_client">
				<expose>
					<service name="ROM" />
				</expose>
				<route>
					<service name="Nic"><external ref="to" /></service>
				</route>
			</component>
			<component name="remote_rom_server">
				<route>
					<service name="ROM"><external /></service>
					<service name="Nic"><external ref="from" /></service>
				</route>
			</component>
		</pattern>
	</composite>
</repository>

<platform>
	<subsystem name="zynq">
		<provides>
			<spec name="zynq" />
		</provides>
		<requires>
			<comm name="Network" />
		</requires>
		<config name="zynq.config" />
	</subsystem>

	<subsystem name="pc">
		<requires>
			<comm name="Network" />
		</requires>
		<config name="pc.config" />
	</subsystem>

	<comm name="Network" />
</platform>

<!-- system //-->
<system name="object_recognition"> 
		<child name="CAM" subsystem="zynq">
			<function name="CAMERA_COMP" />
			<dependency>
				<child name="I2C" />
				<child name="GPIO" />
				<child name="VDMA" />
				<child name="PL_IRQ" />
			</dependency>
		</child>

		<child name="PP" subsystem="zynq">
			<function name="POSE_ESTIMATION_SW" />
			<route>
				<service name="ROM"><child name="CAM" /></service>
			</route>
		</child>

		<!--child name="PP">
			<function name="POSE_ESTIMATION_HW" />
			<dependency>
				<child name="Dpr" />
				<child name="VDMA" />
				<child name="PL_IRQ" />
			</dependency>
			<route>
				<service name="ROM"><child name="CAM" /></service>
			</route>
		</child-->

		<child name="I2C" subsystem="zynq"><function name="I2C" /></child>
		<child name="GPIO" subsystem="zynq"><function name="GPIO" /></child>
		<child name="VDMA" subsystem="zynq"><function name="VDMA" /></child>
		<child name="PL_IRQ" subsystem="zynq"><function name="PL_IRQ" /></child>
		<child name="Dpr" subsystem="zynq"><function name="Dpr" /></child>
		<child name="NIC1" subsystem="zynq"><function name="Network" /></child>

		<!--child>
			<component name="object_recog" />
			<route>
				<service name="ROM"><child name="PP" /></service>
			</route>
		</child-->

		<child subsystem="pc">
            <component name="pose_estimation" />
			<route>
				<service name="ROM"><child name="PP" /></service>
			</route>
		</child>

		<child name="NIC2" subsystem="pc"><function name="Network" /></child>
</system>
</xml>
